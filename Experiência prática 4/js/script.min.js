class a{constructor(){this.currentPage="index",this.init()}init(){this.setupAccessibility(),this.setupNavigation(),this.setupFormValidation()}setupAccessibility(){this.setupSkipLink(),this.setupHighContrast(),this.setupFontSize(),this.setupKeyboardNavigation()}setupSkipLink(){const e=document.querySelector(".skip-link");e&&e.addEventListener("click",e=>{e.preventDefault();const t=document.querySelector(e.target.getAttribute("href"));t&&(t.setAttribute("tabindex","-1"),t.focus())})}setupHighContrast(){const e=document.getElementById("high-contrast-btn");e&&e.addEventListener("click",()=>{document.body.classList.toggle("high-contrast"),localStorage.setItem("highContrast",document.body.classList.contains("high-contrast"))}),"true"===localStorage.getItem("highContrast")&&document.body.classList.add("high-contrast")}setupFontSize(){const e=document.getElementById("font-size-btn");e&&e.addEventListener("click",()=>{document.body.classList.toggle("large-text"),localStorage.setItem("largeText",document.body.classList.contains("large-text"))}),"true"===localStorage.getItem("largeText")&&document.body.classList.add("large-text")}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closeAllMenus(),"Tab"===e.key&&this.handleTabNavigation(e)})}closeAllMenus(){document.querySelectorAll(".nav-menu.active").forEach(e=>{e.classList.remove("active")});const e=document.querySelector(".menu-toggle");e&&e.setAttribute("aria-expanded","false")}handleTabNavigation(e){const t=document.activeElement;t&&t.classList.add("keyboard-focused"),document.addEventListener("mousedown",()=>{document.querySelectorAll(".keyboard-focused").forEach(e=>{e.classList.remove("keyboard-focused")})},{once:!0})}setupNavigation(){this.setupLinkInterceptors(),this.setupHistoryHandler(),this.setupMenuToggle()}setupLinkInterceptors(){document.addEventListener("click",e=>{const t=e.target.closest("a[href]");t&&!t.href.startsWith("http")&&(e.preventDefault(),this.handleNavigation(t.getAttribute("href")))})}setupHistoryHandler(){window.addEventListener("popstate",()=>{this.loadPage(window.location.pathname,!1)})}handleNavigation(e){history.pushState({},"",e),this.loadPage(e,!0)}async loadPage(e,t=!0){try{const s=await fetch(e);if(!s.ok)throw new Error("Página não encontrada");const n=await s.text(),a=new DOMParser().parseFromString(n,"text/html").querySelector("main");if(a){t&&await this.animatePageTransition(),this.updatePageContent(a.innerHTML),this.updateActiveNavigation(e),this.initializePageComponents(),this.announcePageChange(e),window.scrollTo({top:0,behavior:"smooth"})}}catch(e){this.showErrorMessage("Erro ao carregar a página")}}announcePageChange(e){const t=document.querySelector("main h1")||document.querySelector("main h2"),s=t?t.textContent:"Nova página carregada";this.speakToScreenReader(s)}speakToScreenReader(e){const t=document.getElementById("sr-announce");t?t.textContent=e:(this.createScreenReaderAnnouncement(e),setTimeout(()=>{document.getElementById("sr-announce").remove()},1e3))}createScreenReaderAnnouncement(e){const t=document.createElement("div");t.id="sr-announce",t.className="sr-only",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.textContent=e,document.body.appendChild(t)}async animatePageTransition(){return new Promise(e=>{const t=document.querySelector("main");t.style.opacity="0",setTimeout(()=>{t.style.opacity="1",t.style.transition="opacity 0.3s ease",e()},50)})}updatePageContent(e){document.querySelector("main").innerHTML=e}updateActiveNavigation(e){document.querySelectorAll(".nav-link").forEach(t=>{t.classList.remove("active"),t.getAttribute("href")===e&&t.classList.add("active")})}setupMenuToggle(){const e=document.querySelector(".menu-toggle"),t=document.querySelector(".nav-menu");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active"),e.setAttribute("aria-expanded",t.classList.contains("active"))}),e.addEventListener("keydown",s=>{("Enter"===s.key||" "===s.key)&&(s.preventDefault(),t.classList.toggle("active"),e.setAttribute("aria-expanded",t.classList.contains("active")))}))}initializePageComponents(){this.setupAccessibility(),this.setupNavigation(),this.setupFormValidation()}showErrorMessage(e){const t=document.createElement("div");t.className="alert alert-error",t.textContent=e,document.querySelector("main").prepend(t),setTimeout(()=>t.remove(),5e3)}}class s{constructor(e){this.form=e,this.fields={nome:{required:!0,pattern:/^[A-Za-zÀ-ÿ\s]{2,}$/},email:{required:!0,pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/},cpf:{required:!0,pattern:/^\d{3}\.\d{3}\.\d{3}-\d{2}$/},telefone:{required:!0,pattern:/^\(\d{2}\)\s\d{4,5}-\d{4}$/},nascimento:{required:!0},cep:{required:!0,pattern:/^\d{5}-\d{3}$/},endereco:{required:!0},cidade:{required:!0},estado:{required:!0},termos:{required:!0}},this.init()}init(){this.setupMasks(),this.setupValidation(),this.setupSubmitHandler(),this.setupAriaLabels()}setupAriaLabels(){const e=this.form.querySelectorAll("[required]");e.forEach(e=>{const t=e.getAttribute("aria-label")||e.previousElementSibling?.textContent;e.setAttribute("aria-required","true"),!e.hasAttribute("aria-label")&&t&&e.setAttribute("aria-label",t)})}setupMasks(){const e=document.getElementById("cpf"),t=document.getElementById("telefone"),s=document.getElementById("cep");e&&e.addEventListener("input",e=>{e.target.value=this.maskCPF(e.target.value)}),t&&t.addEventListener("input",e=>{e.target.value=this.maskPhone(e.target.value)}),s&&s.addEventListener("input",e=>{e.target.value=this.maskCEP(e.target.value)})}maskCPF(e){return e.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2").slice(0,14)}maskPhone(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").slice(0,15)}maskCEP(e){return e.replace(/\D/g,"").replace(/(\d{5})(\d)/,"$1-$2").slice(0,9)}setupValidation(){Object.keys(this.fields).forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("blur",()=>this.validateField(e)),t.addEventListener("input",()=>this.clearError(e))),t&&t.addEventListener("focus",()=>{t.classList.add("keyboard-focused")})})}validateField(e){const t=document.getElementById(e),s=this.fields[e],n=document.getElementById(`${e}-error`);if(!t||!s)return!0;let a=!0,o="";if(s.required&&!t.value.trim()&&(a=!1,o="Este campo é obrigatório."),s.pattern&&!s.pattern.test(t.value)&&(a=!1,o="Formato inválido."),"nascimento"===e){const e=new Date(t.value),s=new Date,n=s.getFullYear()-e.getFullYear();n<16&&(a=!1,o="É necessário ter pelo menos 16 anos.")}return this.updateFieldStatus(e,a,o),a}updateFieldStatus(e,t,s){const n=document.getElementById(e),a=document.getElementById(`${e}-error`);n&&a&&(t?(n.classList.remove("error"),n.classList.add("success"),a.textContent="",a.classList.remove("visible"),n.setAttribute("aria-invalid","false")):(n.classList.remove("success"),n.classList.add("error"),a.textContent=s,a.classList.add("visible"),n.setAttribute("aria-invalid","true")))}clearError(e){const t=document.getElementById(`${e}-error`);t&&(t.textContent="",t.classList.remove("visible"))}validateForm(){let e=!0;return Object.keys(this.fields).forEach(t=>{this.validateField(t)||(e=!1)}),e}setupSubmitHandler(){this.form.addEventListener("submit",e=>{e.preventDefault(),this.validateForm()?this.handleSuccess():this.showGlobalError()})}handleSuccess(){const e=document.getElementById("feedback"),t=document.getElementById("formCadastro");e&&t&&(t.classList.add("hidden"),e.classList.remove("hidden"),e.setAttribute("tabindex","-1"),e.focus(),e.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{t.reset(),t.classList.remove("hidden"),e.classList.add("hidden")},5e3))}showGlobalError(){let e=document.getElementById("global-error");e||(e=document.createElement("div"),e.id="global-error",e.className="alert alert-error",e.textContent="Por favor, corrija os erros destacados no formulário.",this.form.insertBefore(e,this.form.firstChild));const t=document.querySelector(".error");t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus())}}document.addEventListener("DOMContentLoaded",()=>{new a});class n{constructor(){this.init()}init(){this.setupReducedMotion()}setupReducedMotion(){window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(document.documentElement.style.scrollBehavior="auto")}}new n;
