class a{constructor(){this.currentPage="index",this.init()}init(){this.setupLinkInterceptors(),this.setupHistoryHandler(),this.setupMenuToggle()}setupLinkInterceptors(){document.addEventListener("click",e=>{const t=e.target.closest("a[href]");t&&!t.href.startsWith("http")&&(e.preventDefault(),this.handleNavigation(t.getAttribute("href")))})}setupHistoryHandler(){window.addEventListener("popstate",()=>{this.loadPage(window.location.pathname,!1)})}handleNavigation(e){history.pushState({},"",e),this.loadPage(e,!0)}async loadPage(e,t=!0){try{const s=await fetch(e);if(!s.ok)throw new Error("Página não encontrada");const n=await s.text(),a=(new DOMParser).parseFromString(n,"text/html").querySelector("main");if(a){t&&await this.animatePageTransition(),this.updatePageContent(a.innerHTML),this.updateActiveNavigation(e),this.initializePageComponents(),window.scrollTo({top:0,behavior:"smooth"})}}catch(e){this.showErrorMessage("Erro ao carregar a página")}}async animatePageTransition(){return new Promise(e=>{const t=document.querySelector("main");t.style.opacity="0",setTimeout(()=>{t.style.opacity="1",t.style.transition="opacity 0.3s ease",e()},50)})}updatePageContent(e){document.querySelector("main").innerHTML=e}updateActiveNavigation(e){document.querySelectorAll(".nav-link").forEach(t=>{t.classList.remove("active"),t.getAttribute("href")===e&&t.classList.add("active")})}setupMenuToggle(){const e=document.querySelector(".menu-toggle"),t=document.querySelector(".nav-menu");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active")})}initializePageComponents(){this.setupMenuToggle(),this.initializeFormValidation()}showErrorMessage(e){const t=document.createElement("div");t.className="alert alert-error",t.textContent=e,document.querySelector("main").prepend(t),setTimeout(()=>t.remove(),5e3)}}class s{constructor(e){this.form=e,this.validationRules=this.getValidationRules(),this.init()}getValidationRules(){return{nome:{required:!0,pattern:/^[A-Za-zÀ-ÿ\s]{2,}$/,errorMessage:"Nome deve ter pelo menos 2 caracteres"},email:{required:!0,pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,errorMessage:"Digite um email válido"},cpf:{required:!0,pattern:/^\d{3}\.\d{3}\.\d{3}-\d{2}$/,errorMessage:"CPF no formato 000.000.000-00"},telefone:{required:!0,pattern:/^\(\d{2}\)\s\d{4,5}-\d{4}$/,errorMessage:"Telefone no formato (00) 00000-0000"},nascimento:{required:!0,validate:e=>this.validateAge(e),errorMessage:"É necessário ter pelo menos 16 anos"},cep:{required:!0,pattern:/^\d{5}-\d{3}$/,errorMessage:"CEP no formato 00000-000"},endereco:{required:!0,errorMessage:"Endereço é obrigatório"},cidade:{required:!0,errorMessage:"Cidade é obrigatória"},estado:{required:!0,errorMessage:"Estado é obrigatório"},termos:{required:!0,errorMessage:"Aceite os termos para continuar"}}}init(){this.setupInputMasks(),this.setupRealTimeValidation(),this.setupFormSubmission()}setupInputMasks(){this.initializeCPFMask(),this.initializePhoneMask(),this.initializeCEPMask()}initializeCPFMask(){const e=document.getElementById("cpf");e&&e.addEventListener("input",e=>{e.target.value=this.applyCPFMask(e.target.value)})}initializePhoneMask(){const e=document.getElementById("telefone");e&&e.addEventListener("input",e=>{e.target.value=this.applyPhoneMask(e.target.value)})}initializeCEPMask(){const e=document.getElementById("cep");e&&e.addEventListener("input",e=>{e.target.value=this.applyCEPMask(e.target.value)})}applyCPFMask(e){return e.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2").slice(0,14)}applyPhoneMask(e){return e.replace(/\D/g,"").replace(/(\d{2})(\d)/,"($1) $2").replace(/(\d{5})(\d)/,"$1-$2").slice(0,15)}applyCEPMask(e){return e.replace(/\D/g,"").replace(/(\d{5})(\d)/,"$1-$2").slice(0,9)}setupRealTimeValidation(){Object.keys(this.validationRules).forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("blur",()=>this.validateField(e)),t.addEventListener("input",()=>this.clearFieldError(e)))})}validateField(e){const t=document.getElementById(e),s=this.validationRules[e];let n=!0,a="";if(s.required&&!t.value.trim())n=!1,a="Este campo é obrigatório";else if(s.pattern&&!s.pattern.test(t.value))n=!1,a=s.errorMessage;else if(s.validate&&!s.validate(t.value))n=!1,a=s.errorMessage;return this.updateFieldVisualFeedback(e,n,a),n}validateAge(e){return new Date().getFullYear()-new Date(e).getFullYear()>=16}updateFieldVisualFeedback(e,t,s){const n=document.getElementById(e),a=document.getElementById(`${e}-error`);t?(n.classList.remove("error"),n.classList.add("success"),a.textContent="",a.classList.remove("visible")):(n.classList.remove("success"),n.classList.add("error"),a.textContent=s,a.classList.add("visible"))}clearFieldError(e){const t=document.getElementById(`${e}-error`);t.textContent="",t.classList.remove("visible")}validateCompleteForm(){let e=!0;return Object.keys(this.validationRules).forEach(t=>{this.validateField(t)||(e=!1)}),e}setupFormSubmission(){this.form.addEventListener("submit",e=>{e.preventDefault(),this.validateCompleteForm()?this.handleFormSuccess():this.showFormLevelError()})}handleFormSuccess(){const e=document.getElementById("formCadastro"),t=document.getElementById("feedback");e.classList.add("hidden"),t.classList.remove("hidden"),t.scrollIntoView({behavior:"smooth"})}showFormLevelError(){let e=document.getElementById("global-form-error");e||(e=document.createElement("div"),e.id="global-form-error",e.className="alert alert-error",e.textContent="Por favor, corrija os erros destacados no formulário.",this.form.parentNode.insertBefore(e,this.form));const t=document.querySelector(".error");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}document.addEventListener("DOMContentLoaded",()=>{new a;const e=document.getElementById("formCadastro");e&&new s(e)});
